<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" as="font" href="https://block.github.io/ftl/fonts/vendor/jost/jost-v4-latin-regular.woff2" type="font/woff2" crossorigin>
  <link rel="preload" as="font" href="https://block.github.io/ftl/fonts/vendor/jost/jost-v4-latin-700.woff2"  type="font/woff2" crossorigin>


<link rel="stylesheet" href="https://block.github.io/ftl/main.css">



  
  
    
  

  
  
    
    
  
  
  
    
  
  
  
  
    
  
  
  


  <meta name="robots" content="index, follow">
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">


	


	

<title>PubSub | FTL</title>
<meta name="description" content="Asynchronous publishing of events to topics">
<link rel="canonical" href="https://block.github.io/ftl/docs/reference/pubsub/">










<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    
      
      
        
        
        
        
        
        
        
        
          {
            "@type": "ListItem",
            "position":  1 ,
            "name": "Home",
            "item": "https://block.github.io/ftl/"
          },
          
          
          {
            "@type": "ListItem",
            "position":  2 ,
            "name": "Docs",
            "item": "https://block.github.io/ftl/docs/"
          },
        
      
        
        
        
        
        
        
        
        
          
          
          {
            "@type": "ListItem",
            "position":  3 ,
            "name": "Reference",
            "item": "https://block.github.io/ftl/docs/reference/"
          },
        
      
        
        
        
        
        
        
        
        
          
          
          {
            "@type": "ListItem",
            "position":  4 ,
            "name": "Pubsub",
            "item": "https://block.github.io/ftl/docs/reference/pubsub/"
          },
        
      
    
  }
</script>






  <meta name="theme-color" content="#fff">
  <link rel="apple-touch-icon" sizes="180x180" href="https://block.github.io/ftl/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://block.github.io/ftl/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://block.github.io/ftl/favicon-16x16.png">
  
    <link rel="manifest" href="https://block.github.io/ftl/site.webmanifest" crossorigin>
  


  

</head>

  

<body class="docs single">
  
  
  
  
<div class="header-bar fixed-top"></div>
<header class="navbar fixed-top navbar-expand-md navbar-light">
	<div class="container">
		<input class="menu-btn order-0" type="checkbox" id="menu-btn">
		<label class="menu-icon d-md-none" for="menu-btn"><span class="navicon"></span></label>
		<a class="navbar-brand order-1 order-md-0 me-auto" href="https://block.github.io/ftl/">FTL</a>
		<button id="mode" class="btn btn-link order-2 order-md-4" type="button" aria-label="Toggle mode">
			<span class="toggle-dark"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></span>
			<span class="toggle-light"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></span>
		</button>
		<ul class="navbar-nav fork-me order-3 order-md-5">
			
				
					<li class="nav-item">
						<a class="nav-link" href="https://twitter.com/blocks"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg><span class="ms-2 visually-hidden">Twitter</span></a>
					</li>
				
					<li class="nav-item">
						<a class="nav-link" href="https://github.com/block/ftl"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg><span class="ms-2 visually-hidden">GitHub</span></a>
					</li>
				
			
		</ul>
		<div class="collapse navbar-collapse order-4 order-md-1">
			<ul class="navbar-nav main-nav me-auto order-5 order-md-2">
				
					
				
				
				
					
						<li class="nav-item docs active">
							<a class="nav-link" href="https://block.github.io/ftl/docs/getting-started/introduction/">Docs</a>
						</li>
					
				
			</ul>
			<div class="break order-6 d-md-none"></div>
			
				<form class="navbar-form flex-grow-1 order-7 order-md-3">
					<input id="userinput" class="form-control is-search" type="search" placeholder="Search docs..."
						aria-label="Search docs..." autocomplete="off">
					<div id="suggestions" class="shadow bg-white rounded"></div>
				</form>
			
		</div>
	</div>
</header>



  
<div class="wrap container" role="document">
  <div class="content">
    <div class="row flex-xl-nowrap">
	  
<div class="col-lg-5 col-xl-4 docs-sidebar">
	<nav class="docs-links" aria-label="Main navigation">
			
			
			
			
					
					
					
							<h3>Getting Started</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://block.github.io/ftl/docs/getting-started/introduction/">Introduction</a></li>
							                           
									<li><a class="docs-link" href="https://block.github.io/ftl/docs/getting-started/quick-start/">Quick Start</a></li>
							
					</ul>
					
					
					
					
							<h3>Reference</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://block.github.io/ftl/docs/reference/start/">Start</a></li>
							                           
									<li><a class="docs-link" href="https://block.github.io/ftl/docs/reference/verbs/">Verbs</a></li>
							                           
									<li><a class="docs-link" href="https://block.github.io/ftl/docs/reference/types/">Types</a></li>
							                           
									<li><a class="docs-link" href="https://block.github.io/ftl/docs/reference/visibility/">Visibility</a></li>
							                           
									<li><a class="docs-link" href="https://block.github.io/ftl/docs/reference/ingress/">HTTP Ingress</a></li>
							                           
									<li><a class="docs-link" href="https://block.github.io/ftl/docs/reference/cron/">Cron</a></li>
							                           
									<li><a class="docs-link" href="https://block.github.io/ftl/docs/reference/secretsconfig/">Secrets&#x2F;Config</a></li>
							                           
									<li><a class="docs-link active" href="https://block.github.io/ftl/docs/reference/pubsub/">PubSub</a></li>
							                           
									<li><a class="docs-link" href="https://block.github.io/ftl/docs/reference/retries/">Retries</a></li>
							                           
									<li><a class="docs-link" href="https://block.github.io/ftl/docs/reference/externaltypes/">External Types</a></li>
							                           
									<li><a class="docs-link" href="https://block.github.io/ftl/docs/reference/unittests/">Unit Tests</a></li>
							                           
									<li><a class="docs-link" href="https://block.github.io/ftl/docs/reference/matrix/">Feature Matrix</a></li>
							
					</ul>
					
					
					
					
							<h3>Help</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://block.github.io/ftl/docs/help/faq/">FAQ</a></li>
							                           
									<li><a class="docs-link" href="https://block.github.io/ftl/docs/help/glossary/">Glossary</a></li>
							
					</ul>
					
					
					
					
							<h3>Observability</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://block.github.io/ftl/docs/observability/metrics/">Metrics</a></li>
							
					</ul>
					
					
			
	</nav>
</div>

	  
  
  <nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation">
  	<div class="page-links">
  			<h3>On this page</h3>
  			<nav id="TableOfContents">
  					<ul>
  							
  					</ul>
  			</nav>
  	</div>
  </nav>
  

      <main class="docs-content col-lg-11 col-xl-9">
        <h1>PubSub</h1>
        
        <p>FTL has first-class support for PubSub, modelled on the concepts of topics (where events are sent) and subscribers (a verb which consumes events). Subscribers are, as you would expect, sinks. Each subscriber is a cursor over the topic it is associated with. Each topic may have multiple subscriptions. Each published event has an at least once delivery guarantee for each subscription.</p>
<div class="code-selector">
<ul class="nav nav-tabs mb-2">
</ul>
<!-- go -->
<p>First, declare a new topic:</p>
<pre data-lang="go" style="background-color:#2b303b;color:#c0c5ce;" class="language-go "><code class="language-go" data-lang="go"><span style="color:#b48ead;">package </span><span style="color:#bf616a;">payments
</span><span>
</span><span style="color:#b48ead;">import </span><span>(
</span><span>  &quot;</span><span style="color:#a3be8c;">github.com/block/ftl/go-runtime/ftl</span><span>&quot;
</span><span>)
</span><span style="color:#b48ead;">type </span><span>Invoice </span><span style="color:#b48ead;">struct </span><span>{
</span><span>  </span><span style="color:#bf616a;">InvoiceNo </span><span style="color:#b48ead;">string
</span><span>}
</span><span>
</span><span style="color:#65737e;">//ftl:export
</span><span style="color:#b48ead;">type </span><span>Invoices = </span><span style="color:#bf616a;">ftl</span><span>.</span><span style="color:#b48ead;">TopicHandle</span><span>[</span><span style="color:#bf616a;">Invoice</span><span>, </span><span style="color:#bf616a;">ftl</span><span>.</span><span style="color:#bf616a;">SinglePartitionMap</span><span>[</span><span style="color:#bf616a;">Invoice</span><span>]]
</span></code></pre>
<p>Note that the name of the topic as represented in the FTL schema is the lower camel case version of the type name.</p>
<p>The <code>Invoices</code> type is a handle to the topic. It is a generic type that takes two arguments: the event type and the partition map type. The partition map type is used to map events to partitions. In this case, we are using a single partition map, which means that all events are sent to the same partition.</p>
<p>Then define a Sink to consume from the topic:</p>
<pre data-lang="go" style="background-color:#2b303b;color:#c0c5ce;" class="language-go "><code class="language-go" data-lang="go"><span style="color:#65737e;">//ftl:subscribe payments.invoices from=beginning
</span><span style="color:#b48ead;">func </span><span style="color:#8fa1b3;">SendInvoiceEmail</span><span>(</span><span style="color:#bf616a;">ctx context</span><span>.</span><span style="color:#b48ead;">Context</span><span>, </span><span style="color:#bf616a;">in </span><span style="color:#b48ead;">Invoice</span><span>) </span><span style="color:#b48ead;">error </span><span>{
</span><span>  </span><span style="color:#65737e;">// ...
</span><span>}
</span></code></pre>
<p>Events can be published to a topic by injecting the topic type into a verb:</p>
<pre data-lang="go" style="background-color:#2b303b;color:#c0c5ce;" class="language-go "><code class="language-go" data-lang="go"><span style="color:#b48ead;">func </span><span style="color:#8fa1b3;">PublishInvoice</span><span>(</span><span style="color:#bf616a;">ctx context</span><span>.</span><span style="color:#b48ead;">Context</span><span>, </span><span style="color:#bf616a;">topic </span><span style="color:#b48ead;">Invoices</span><span>) </span><span style="color:#b48ead;">error </span><span>{
</span><span>   </span><span style="color:#bf616a;">topic</span><span>.</span><span style="color:#bf616a;">Publish</span><span>(</span><span style="color:#bf616a;">ctx</span><span>, </span><span style="color:#bf616a;">Invoice</span><span>{...})
</span><span>   </span><span style="color:#65737e;">// ...
</span><span>}
</span></code></pre>
<!-- kotlin -->
<p>First, declare a new topic :</p>
<pre data-lang="kotlin" style="background-color:#2b303b;color:#c0c5ce;" class="language-kotlin "><code class="language-kotlin" data-lang="kotlin"><span>
</span><span style="color:#b48ead;">import</span><span> com.block.ftl.WriteableTopic
</span><span>
</span><span style="color:#b48ead;">data class </span><span style="color:#ebcb8b;">Invoice</span><span>(</span><span style="color:#b48ead;">val </span><span>invoiceNo: </span><span style="color:#b48ead;">String</span><span>)
</span><span>
</span><span>@Export
</span><span>@Topic(&quot;</span><span style="color:#a3be8c;">invoices</span><span>&quot;)
</span><span style="color:#b48ead;">internal interface </span><span style="color:#ebcb8b;">InvoiceTopic </span><span>: </span><span style="color:#a3be8c;">WriteableTopic</span><span>&lt;</span><span style="color:#a3be8c;">Invoice</span><span>&gt;
</span></code></pre>
<p>Events can be published to a topic by injecting it into an <code>@Verb</code> method:</p>
<pre data-lang="kotlin" style="background-color:#2b303b;color:#c0c5ce;" class="language-kotlin "><code class="language-kotlin" data-lang="kotlin"><span>@Verb
</span><span style="color:#b48ead;">fun </span><span style="color:#8fa1b3;">publishInvoice</span><span>(request: InvoiceRequest, topic: InvoiceTopic) {
</span><span>    topic.publish(Invoice(request.getInvoiceNo()))
</span><span>}
</span></code></pre>
<p>To subscribe to a topic use the <code>@Subscription</code> annotation, referencing the topic class and providing a method to consume the event:</p>
<pre data-lang="kotlin" style="background-color:#2b303b;color:#c0c5ce;" class="language-kotlin "><code class="language-kotlin" data-lang="kotlin"><span>@Subscription(topic = InvoiceTopic::class, from = FromOffset.</span><span style="color:#d08770;">LATEST</span><span>)
</span><span style="color:#b48ead;">fun </span><span style="color:#8fa1b3;">consumeInvoice</span><span>(event: Invoice) {
</span><span>    </span><span style="color:#65737e;">// ...
</span><span>}
</span></code></pre>
<p>If you are subscribing to a topic from another module, FTL will generate a topic class for you so you can subscribe to it. This generated
topic cannot be published to, only subscribed to:</p>
<pre data-lang="kotlin" style="background-color:#2b303b;color:#c0c5ce;" class="language-kotlin "><code class="language-kotlin" data-lang="kotlin"><span>@Topic(name=&quot;</span><span style="color:#a3be8c;">invoices</span><span>&quot;, module=&quot;</span><span style="color:#a3be8c;">publisher</span><span>&quot;)
</span><span style="color:#b48ead;">internal interface </span><span style="color:#ebcb8b;">InvoiceTopic </span><span>: </span><span style="color:#a3be8c;">ConsumableTopic</span><span>&lt;</span><span style="color:#a3be8c;">Invoice</span><span>&gt;
</span></code></pre>
<!-- java -->
<p>First, declare a new topic:</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">import </span><span>com.block.ftl.</span><span style="color:#ebcb8b;">WriteableTopic</span><span>;
</span><span>
</span><span>record </span><span style="color:#bf616a;">Invoice</span><span>(</span><span style="color:#ebcb8b;">String</span><span> invoiceNo) {}
</span><span>
</span><span>@</span><span style="color:#bf616a;">Export
</span><span>@</span><span style="color:#bf616a;">Topic</span><span>(&quot;</span><span style="color:#a3be8c;">invoices</span><span>&quot;)
</span><span style="color:#b48ead;">public interface </span><span style="color:#ebcb8b;">InvoiceTopic </span><span style="color:#b48ead;">extends </span><span style="color:#a3be8c;">WriteableTopic</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">Invoice</span><span style="color:#eff1f5;">&gt; {}
</span></code></pre>
<p>Events can be published to a topic by injecting it into an <code>@Verb</code> method:</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span>@</span><span style="color:#bf616a;">Verb
</span><span>void </span><span style="color:#bf616a;">publishInvoice</span><span>(</span><span style="color:#ebcb8b;">InvoiceRequest</span><span> request, </span><span style="color:#ebcb8b;">InvoiceTopic</span><span> topic) throws </span><span style="color:#ebcb8b;">Exception </span><span>{
</span><span>    topic.</span><span style="color:#bf616a;">publish</span><span>(</span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">Invoice</span><span>(request.</span><span style="color:#bf616a;">getInvoiceNo</span><span>()));
</span><span>}
</span></code></pre>
<p>To subscribe to a topic use the <code>@Subscription</code> annotation, referencing the topic class and providing a method to consume the event:</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span>@</span><span style="color:#bf616a;">Subscription</span><span>(</span><span style="color:#bf616a;">topic </span><span>= </span><span style="color:#ebcb8b;">InvoiceTopic</span><span>.</span><span style="color:#bf616a;">class</span><span>, </span><span style="color:#bf616a;">from </span><span>= </span><span style="color:#ebcb8b;">FromOffset</span><span>.</span><span style="color:#d08770;">LATEST</span><span>)
</span><span style="color:#b48ead;">public</span><span> void </span><span style="color:#bf616a;">consumeInvoice</span><span>(</span><span style="color:#ebcb8b;">Invoice</span><span> event) {
</span><span>    </span><span style="color:#65737e;">// ...
</span><span>}
</span></code></pre>
<p>If you are subscribing to a topic from another module, FTL will generate a topic class for you so you can subscribe to it. This generated
topic cannot be published to, only subscribed to:</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span>@</span><span style="color:#bf616a;">Topic</span><span>(</span><span style="color:#bf616a;">name</span><span>=&quot;</span><span style="color:#a3be8c;">invoices</span><span>&quot;, </span><span style="color:#bf616a;">module</span><span>=&quot;</span><span style="color:#a3be8c;">publisher</span><span>&quot;)
</span><span> </span><span style="color:#b48ead;">interface </span><span style="color:#ebcb8b;">InvoiceTopic </span><span style="color:#b48ead;">extends </span><span style="color:#a3be8c;">ConsumableTopic</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">Invoice</span><span style="color:#eff1f5;">&gt; {}
</span></code></pre>
</div>
<blockquote>
<p><strong>NOTE!</strong>
PubSub topics cannot be published to from outside the module that declared them, they can only be subscribed to. That is, if a topic is declared in module <code>A</code>, module <code>B</code> cannot publish to it.</p>
</blockquote>

        
        
<div class="docs-navigation d-flex justify-content-between">
  
  
  
  
  
    
    
    
    
      
        
        
          
        
      
        
        
          
        
      
        
        
          
        
      
        
        
          
            
              
              <a href="https:&#x2F;&#x2F;block.github.io&#x2F;ftl&#x2F;docs&#x2F;getting-started&#x2F;quick-start&#x2F;">
                <div class="card my-1">
                  <div class="card-body py-2">
                    &larr; Quick Start
                  </div>
                </div>
              </a>
            
            
            
          
        
      
    
  

  
  
  
  
  
    
    
    
      
      
        
      
    
      
      
        
      
    
      
      
        
          
          
          <a class="ms-auto" href="https:&#x2F;&#x2F;block.github.io&#x2F;ftl&#x2F;docs&#x2F;help&#x2F;faq&#x2F;">
            <div class="card my-1">
              <div class="card-body py-2">
                FAQ &rarr;
              </div>
            </div>
          </a>
          
          
          
        
      
    
      
      
        
      
    
  
</div>

      </main>
    </div>
  </div>
</div>


  

    
<footer class="footer text-muted">
	<div class="container">
		<div class="row">
			<div class="col-lg-8 order-last order-lg-first">
				<ul class="list-inline">
					
						<li class="list-inline-item">Powered by <a href="https://www.getzola.org/">Zola</a>, and <a href="https://github.com/aaranxu/adidoks">AdiDoks</a></li>
					
				</ul>
			</div>
			<div class="col-lg-8 order-first order-lg-last text-lg-end">
				<ul class="list-inline">
					
				</ul>
			</div>
		</div>
	</div>
</footer>

  
<script src="https://block.github.io/ftl/js/code-selector.js" defer>
</script>


  
<script type="text/javascript" src="https://block.github.io/ftl/js/main.js" defer></script>

  <script type="text/javascript" src="https://block.github.io/ftl/plugins/elasticlunr.min.js" defer></script>
  <script type="text/javascript" src="https://block.github.io/ftl/search_index.en.js" defer></script>
  <script type="text/javascript" src="https://block.github.io/ftl/js/search.js" defer></script>

  
</body>
</html>
