-- migrate:up

CREATE TABLE encryption_keys (
    id          BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    key         bytea NOT NULL,
    created_at  TIMESTAMPTZ NOT NULL DEFAULT (NOW() AT TIME ZONE 'utc')
);

ALTER TABLE events
    ALTER COLUMN payload TYPE bytea
        USING payload::text::bytea;

ALTER TABLE async_calls
    ALTER COLUMN request TYPE bytea
        USING request::text::bytea,
    ALTER COLUMN response TYPE bytea
        USING response::text::bytea;

-- migrate:down
