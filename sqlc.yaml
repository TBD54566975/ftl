version: "2"
sql:
  - engine: "postgresql"
    queries: "backend/controller/internal/sql/queries.sql"
    schema: "backend/controller/internal/sql/schema"
    database:
      uri: postgres://localhost/ftl?sslmode=disable&user=postgres&password=secret
    gen:
      go:
        package: "sql"
        sql_package: "pgx/v5"
        out: "backend/controller/internal/sql"
        emit_interface: true
        query_parameter_limit: 3
        overrides:
          - db_type: "uuid"
            go_type: "github.com/TBD54566975/ftl/backend/controller/internal/sqltypes.Key"
          - db_type: "uuid"
            nullable: true
            go_type: "github.com/TBD54566975/ftl/backend/controller/internal/sqltypes.NullKey"
          - column: "runners.languages"
            go_type: "github.com/TBD54566975/ftl/backend/controller/internal/sqltypes.Languages"
          - column: "deployments.name"
            go_type: "github.com/TBD54566975/ftl/backend/common/model.DeploymentName"
    rules:
      - sqlc/db-prepare
#      - has-index
#      - postgresql-query-too-costly
      - postgresql-no-seq-scan
rules:
- name: postgresql-query-too-costly
  message: "Query cost estimate is too high"
  rule: "postgresql.explain.plan.total_cost > 100.0"
- name: postgresql-no-seq-scan
  message: "Query plan results in a sequential scan"
  rule: "postgresql.explain.plan.node_type == 'Seq Scan'"
