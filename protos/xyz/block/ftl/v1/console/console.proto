syntax = "proto3";

package xyz.block.ftl.v1.console;

import "xyz/block/ftl/v1/ftl.proto";
import "xyz/block/ftl/v1/schema/schema.proto";

option go_package = "github.com/TBD54566975/ftl/protos/xyz/block/ftl/v1/console;pbconsole";
option java_multiple_files = true;

message Call {
  int64 id = 1;
  string runner_key = 2;
  string request_key = 3;
  string controller_key = 4;
  int64 time_stamp = 5;

  string source_module = 6;
  string source_verb = 7;
  string dest_module = 8;
  string dest_verb = 9;
  int64 duration_ms = 10;
  string request = 11;
  string response = 12;
  string error = 13;
}

message Deployment {
  string key = 1;
  string language = 2;
  string name = 3;
  int32 min_replicas = 4;
}

message TimelineEntry {
  int64 time_stamp = 1;
  oneof entry {
    Call call = 2;
    Deployment deployment = 3;
  }
}

message Verb {
  schema.Verb verb = 1;
}

message Module {
  string name = 1;
  string language = 2;
  repeated Verb verbs = 3;
  repeated schema.Data data = 4;
}

message GetModulesRequest {}
message GetModulesResponse {
  repeated Module modules = 1;
}

message GetCallsRequest {
  string module = 1;
  string verb = 2;
}

message GetCallsResponse {
  repeated Call calls = 1;
}

message GetRequestCallsRequest {
  string request_key = 1;
}

message GetRequestCallsResponse {
  repeated Call calls = 1;
}

message GetTimelineRequest {
  string module = 1;
}

message GetTimelineResponse {
  repeated TimelineEntry entries = 1;
}

service ConsoleService {
  // Ping service for readiness.
  rpc Ping(PingRequest) returns (PingResponse) {
    option idempotency_level = NO_SIDE_EFFECTS;
  }

  rpc GetModules(GetModulesRequest) returns (GetModulesResponse);
  rpc GetCalls(GetCallsRequest) returns (GetCallsResponse);
  rpc GetRequestCalls(GetRequestCallsRequest) returns (GetRequestCallsResponse);
  rpc GetTimeline(GetTimelineRequest) returns (GetTimelineResponse);
}
