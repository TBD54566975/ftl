#!/bin/bash
set -euo pipefail

top="$(git rev-parse --show-toplevel)"
cd "${top}"

prepare_template() (
  mkdir -p build/template/ftl/jars
  (cd "${top}/kotlin-runtime/ftl-runtime" && gradle jar)
  cp "${top}/kotlin-runtime/ftl-runtime/build/libs/ftl-runtime.jar" build/template/ftl/jars
)

build() {
  make console/client/dist/index.html
  go build -o build/release/ftl-controller -tags release ./cmd/ftl-controller
  go build -o build/release/ftl-runner -tags release ./cmd/ftl-runner
}

prepare_template
build

overmind start -f Procfile.nowatch
